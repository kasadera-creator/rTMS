{% extends "rtms_app/patient/base_patient.html" %}

{% block content %}
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-md-6 col-lg-5">
      <!-- Staff logged-in warning -->
      {% if is_staff_logged_in %}
      <div class="alert alert-warning mb-4" role="alert">
        <h6 class="alert-heading">⚠️ スタッフログイン状態です</h6>
        <p class="mb-0 small">患者ログインを使用するには、まずスタッフアカウントからログアウトしてください。</p>
      </div>
      <div class="card shadow-sm border-0 mb-4">
        <div class="card-body p-4 text-center">
          <p class="mb-3 text-muted">スタッフアカウントをログアウトして患者ログインに進みますか？</p>
          <form method="post" class="d-flex gap-2">
            {% csrf_token %}
            <input type="hidden" name="action" value="logout_and_login">
            <button type="submit" class="btn btn-warning flex-grow-1">ログアウトして患者ログインへ</button>
            <a href="/" class="btn btn-secondary">スタッフメニューに戻る</a>
          </form>
        </div>
      </div>
      {% else %}
      <div class="card shadow-sm border-0">
        <div class="card-body p-4">
          <h1 class="h4 fw-bold mb-3">患者さん自己記入式検査</h1>
          <p class="text-muted small mb-4">登録時に入力した5桁の患者ID（例: 12345）でログインできます。初期パスワードも同じ患者IDです。</p>
          {% if error %}
            <div class="alert alert-danger">{{ error }}</div>
          {% endif %}
          <form method="post" novalidate>
            {% csrf_token %}
            <div class="mb-3">
              <label class="form-label">患者ID (5桁)</label>
              <input type="text" name="username" class="form-control form-control-lg" inputmode="numeric" pattern="[0-9]{5}" placeholder="例: 12345" required>
            </div>
            <div class="mb-4">
              <label class="form-label">パスワード</label>
              <input type="password" name="password" class="form-control form-control-lg" placeholder="初期PW: 患者IDと同じ" required>
            </div>
            <button type="submit" class="btn btn-primary w-100 btn-lg">ログイン</button>
          </form>
          <hr class="my-4">
          <div class="text-center small">
            <a href="/" class="text-muted text-decoration-none">スタッフメニューに戻る</a>
          </div>
        </div>
      </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
