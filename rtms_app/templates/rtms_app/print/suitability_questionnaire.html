{% extends 'rtms_app/print/_print_base_twocolumn.html' %}
{% load static %}

{% block title %}rTMS適正問診票 - {{ patient.name }}{% endblock %}

{% block print_content %}
<div class="page-sheet">
        <h1 class="doc-title">rTMS適正問診票</h1>

        {# 患者情報エリア（デザイン統一） #}
        <table class="summary-info-table">
            <tr>
                <th>患者ID</th>
                <td>{{ patient.card_id }}</td>
                <th>氏名</th>
                <td>{{ patient.name }} 様</td>
            </tr>
            <tr>
                <th>生年月日</th>
                <td>{{ patient.birth_date|date:"Y年n月j日" }} ({{ patient.age }}歳)</td>
                <th>初回評価日</th>
                <td>
                    {% with first_assessment=assessments|first %}
                        {% if first_assessment %}{{ first_assessment.date|date:"Y年n月j日" }}{% else %}-{% endif %}
                    {% endwith %}
                </td>
            </tr>
        </table>

        <div class="content-section" style="margin-top: 20px;">
            {% with q=questionnaire %}
            <table class="questionnaire-table">
                <thead>
                    <tr>
                        <th class="col-no">No.</th>
                        <th>質問項目</th>
                        <th class="col-check">はい</th>
                        <th class="col-check">いいえ</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="section-row"><td colspan="4">これまでに、以下のことがありましたか？</td></tr>
                    <tr>
                        <td class="col-no">1</td>
                        <td>rTMS実施経験（治験・研究を含む）</td>
                        <td class="check-cell">{% if q.q_past_rtms == 'はい' %}☑{% else %}☐{% endif %}</td>
                        <td class="check-cell">{% if q.q_past_rtms == 'いいえ' %}☑{% else %}☐{% endif %}</td>
                    </tr>
                    <tr>
                        <td class="col-no">2</td>
                        <td>rTMS後に副作用などの不快な経験</td>
                        <td class="check-cell">{% if q.q_past_side_effect == 'はい' %}☑{% else %}☐{% endif %}</td>
                        <td class="check-cell">{% if q.q_past_side_effect == 'いいえ' %}☑{% else %}☐{% endif %}</td>
                    </tr>
                    <tr>
                        <td class="col-no">3</td>
                        <td>電気けいれん療法（ECT）の実施歴</td>
                        <td class="check-cell">{% if q.q_past_ect == 'はい' %}☑{% else %}☐{% endif %}</td>
                        <td class="check-cell">{% if q.q_past_ect == 'いいえ' %}☑{% else %}☐{% endif %}</td>
                    </tr>
                    <tr>
                        <td class="col-no">4</td>
                        <td>けいれん発作（てんかん診断の有無を問わない）</td>
                        <td class="check-cell">{% if q.q_past_seizure == 'はい' %}☑{% else %}☐{% endif %}</td>
                        <td class="check-cell">{% if q.q_past_seizure == 'いいえ' %}☑{% else %}☐{% endif %}</td>
                    </tr>
                    <tr>
                        <td class="col-no">5</td>
                        <td>意識消失発作</td>
                        <td class="check-cell">{% if q.q_past_loc == 'はい' %}☑{% else %}☐{% endif %}</td>
                        <td class="check-cell">{% if q.q_past_loc == 'いいえ' %}☑{% else %}☐{% endif %}</td>
                    </tr>
                    <tr>
                        <td class="col-no">6</td>
                        <td>脳卒中（脳梗塞・脳出血など）</td>
                        <td class="check-cell">{% if q.q_past_stroke == 'はい' %}☑{% else %}☐{% endif %}</td>
                        <td class="check-cell">{% if q.q_past_stroke == 'いいえ' %}☑{% else %}☐{% endif %}</td>
                    </tr>
                    <tr>
                        <td class="col-no">7</td>
                        <td>頭部外傷（意識消失を伴うなど重度なもの）</td>
                        <td class="check-cell">{% if q.q_past_trauma == 'はい' %}☑{% else %}☐{% endif %}</td>
                        <td class="check-cell">{% if q.q_past_trauma == 'いいえ' %}☑{% else %}☐{% endif %}</td>
                    </tr>
                    <tr>
                        <td class="col-no">8</td>
                        <td>頭部の手術歴</td>
                        <td class="check-cell">{% if q.q_past_surgery == 'はい' %}☑{% else %}☐{% endif %}</td>
                        <td class="check-cell">{% if q.q_past_surgery == 'いいえ' %}☑{% else %}☐{% endif %}</td>
                    </tr>
                    <tr>
                        <td class="col-no">9</td>
                        <td>脳外科もしくは神経内科の病気</td>
                        <td class="check-cell">{% if q.q_past_neuro == 'はい' %}☑{% else %}☐{% endif %}</td>
                        <td class="check-cell">{% if q.q_past_neuro == 'いいえ' %}☑{% else %}☐{% endif %}</td>
                    </tr>
                    <tr>
                        <td class="col-no">10</td>
                        <td>脳障害をおこす可能性のある内科疾患</td>
                        <td class="check-cell">{% if q.q_past_internal == 'はい' %}☑{% else %}☐{% endif %}</td>
                        <td class="check-cell">{% if q.q_past_internal == 'いいえ' %}☑{% else %}☐{% endif %}</td>
                    </tr>
                    <tr>
                        <td class="col-no">11</td>
                        <td>アルコールや薬物の乱用</td>
                        <td class="check-cell">{% if q.q_past_abuse == 'はい' %}☑{% else %}☐{% endif %}</td>
                        <td class="check-cell">{% if q.q_past_abuse == 'いいえ' %}☑{% else %}☐{% endif %}</td>
                    </tr>
                    <tr class="section-row"><td colspan="4">現在、以下のことはありますか？</td></tr>
                    <tr>
                        <td class="col-no">12</td>
                        <td>頻繁または重度な頭痛</td>
                        <td class="check-cell">{% if q.q_cur_headache == 'はい' %}☑{% else %}☐{% endif %}</td>
                        <td class="check-cell">{% if q.q_cur_headache == 'いいえ' %}☑{% else %}☐{% endif %}</td>
                    </tr>
                    <tr>
                        <td class="col-no">13</td>
                        <td>頭の中に金属や磁性体（チタン製品かどうか要確認）</td>
                        <td class="check-cell">{% if q.q_cur_metal == 'はい' %}☑{% else %}☐{% endif %}</td>
                        <td class="check-cell">{% if q.q_cur_metal == 'いいえ' %}☑{% else %}☐{% endif %}</td>
                    </tr>
                    <tr>
                        <td class="col-no">14</td>
                        <td>体内埋め込み式の医療機器（心臓ペースメーカーなど）</td>
                        <td class="check-cell">{% if q.q_cur_device == 'はい' %}☑{% else %}☐{% endif %}</td>
                        <td class="check-cell">{% if q.q_cur_device == 'いいえ' %}☑{% else %}☐{% endif %}</td>
                    </tr>
                    <tr>
                        <td class="col-no">15</td>
                        <td>多量の飲酒や薬物の乱用</td>
                        <td class="check-cell">{% if q.q_cur_abuse == 'はい' %}☑{% else %}☐{% endif %}</td>
                        <td class="check-cell">{% if q.q_cur_abuse == 'いいえ' %}☑{% else %}☐{% endif %}</td>
                    </tr>
                    <tr>
                        <td class="col-no">16</td>
                        <td>妊娠中、もしくは妊娠の可能性が否定されない</td>
                        <td class="check-cell">{% if q.q_cur_preg == 'はい' %}☑{% else %}☐{% endif %}</td>
                        <td class="check-cell">{% if q.q_cur_preg == 'いいえ' %}☑{% else %}☐{% endif %}</td>
                    </tr>
                    <tr>
                        <td class="col-no">17</td>
                        <td>家族内にてんかんを持っているかた</td>
                        <td class="check-cell">{% if q.q_cur_family_epilepsy == 'はい' %}☑{% else %}☐{% endif %}</td>
                        <td class="check-cell">{% if q.q_cur_family_epilepsy == 'いいえ' %}☑{% else %}☐{% endif %}</td>
                    </tr>
                </tbody>
            </table>
            
            <div style="margin-top: 10px;">
                <div class="section-label" style="font-size: 13px; margin-bottom: 4px;">特記事項・詳細</div>
                <div class="note-box">{{ q.q_details|default:"" }}</div>
            </div>

            <div class="signature-row">
                <div>
                    患者署名
                    <div class="signature-line" style="width: 160px;"></div>
                </div>
                <div>
                    日付
                    <div class="signature-date">{{ today|date:"Y年n月j日" }}</div>
                </div>
            </div>
            {% endwith %}
        </div>

        <div class="page-footer">
            <div>作成日: {{ today|date:"Y年n月j日" }}</div>
            <div>笠寺精治寮病院</div>
        </div>
</div>
{% endblock %}

{% block print_controls %}
<div class="control-section">
    <h5>印刷オプション</h5>
    <div class="btn-group">
        <button id="print-btn" class="btn btn-primary">
            <i class="fas fa-print"></i> 印刷
        </button>
        <button id="pdf-btn" class="btn btn-success">
            <i class="fas fa-file-pdf"></i> PDF保存
        </button>
        <button id="back-btn" class="btn btn-outline-secondary" data-back-url="{{ back_url }}">
            <i class="fas fa-arrow-left"></i> 戻る
        </button>
    </div>
</div>
{% endblock %}