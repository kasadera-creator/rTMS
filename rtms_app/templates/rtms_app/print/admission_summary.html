<div class="page-container">
  <div class="page-sheet">
    {# ヘッダーエリア #}
    <div class="summary-header">
      <div>作成日: {{ today|date:"Y年n月j日" }}</div>
      <div>笠寺精治寮病院</div>
	</div>
    
    <h1 class="doc-title">入院時サマリー</h1>

    {# 患者基本情報 #}
    <table class="summary-info-table">
      <tr>
        <th>カルテID</th><td>{{ patient.card_id }}</td>
        <th>氏名</th><td>{{ patient.name }} 様</td>
      </tr>
      <tr>
        <th>生年月日</th><td>{{ patient.birth_date|date:"Y年n月j日" }}（{{ patient.age }}歳）</td>
        <th>性別</th><td>{{ patient.get_gender_display }}</td>
      </tr>
      <tr>
        <th>紹介元</th><td>{{ patient.referral_source|default:"-" }}</td>
        <th>紹介医</th><td>{{ patient.referral_doctor|default:"-" }}</td>
      </tr>
    </table>
	
	<div class="content-section">
      <div class="section-label">診断名</div>
      <div class="text-content mb-3" style="text-align: left !important;">
        <strong>【診断名】</strong> {{ patient.diagnosis|default:"-" }}
      </div>
    </div>

    <div class="content-section">
      <div class="section-label">病歴・背景</div>
      <div class="text-content" style="text-align: left !important; line-height: 1.6;">
        <div>
            <strong>【主　訴】</strong><br>
            {{ patient.chief_complaint|default:""|linebreaksbr }}
        </div>
        <div>
            <strong>【生活歴】</strong><br>
            {{ patient.life_history|default:"(記載なし)"|linebreaksbr }}
        </div>
        <div>
            <strong>【既往歴】</strong><br>
            {{ patient.past_history|default:"(記載なし)"|linebreaksbr }}
        </div>
        <div>
            <strong>【現病歴】</strong><br>
            {{ patient.present_illness|default:"(記載なし)"|linebreaksbr }}
        </div>
        <div>
            <strong>【薬物治療歴】</strong><br>
            {{ patient.medication_history|default:"(記載なし)"|linebreaksbr }}
        </div>
      </div>
    </div>

    <div class="content-section">
      <div class="section-label">治療前評価（HAM-D）</div>
      <table class="table-basic" style="margin-top: 8px;">
        <tr>
          <th style="width: 120px;">日付</th>
          <th style="width: 100px;">HAM-D17</th>
          <th style="width: 100px;">HAM-D21</th>
          <th>備考</th>
        </tr>
        {% with baseline=None %}
          {% for score in assessments %}
            {% if score.timing == 'baseline' %}
              <tr>
                <td>{{ score.date|date:"Y-m-d" }}</td>
                <td>{{ score.total_score_17|default:"-" }}</td>
                <td>{{ score.total_score_21|default:"-" }}</td>
                <td>{{ score.note|default:""|linebreaksbr }}</td>
              </tr>
            {% endif %}
          {% endfor %}
        {% endwith %}
        {% if assessments|length == 0 %}
          <tr><td colspan="4">評価データは未入力です。</td></tr>
        {% endif %}
      </table>
    </div>

    <div class="content-section">
      <div class="section-label">治療予定（スケジュール）</div>
      <table class="table-basic" style="margin-top: 8px;">
        <tr>
          <th>入院日</th>
          <th>位置決め日</th>
          <th>治療開始日</th>
          <th>治療終了予定（30回）</th>
        </tr>
        <tr>
          <td>{{ patient.admission_date|default:"-" }}</td>
          <td>{{ patient.mapping_date|default:"-" }}</td>
          <td>{{ patient.first_treatment_date|default:"-" }}</td>
          <td>{{ end_date_est|date:"Y-m-d"|default:"-" }}</td>
        </tr>
      </table>
    </div>
</div>