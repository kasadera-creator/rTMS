{% extends 'rtms_app/print/_print_base_twocolumn.html' %}
{% load static %}

{% block title %}退院時サマリー - {{ patient.name }}{% endblock %}

{% block print_content %}
{% comment %} Render directly as A4 page-sheet without outer container %}{% endcomment %}
<div class="page-sheet">
        <h1 class="doc-title">退院時サマリー</h1>

        <table class="summary-info-table">
            <tr>
                <th>患者ID</th>
                <td>{{ patient.card_id }}</td>
                <th>氏名</th>
                <td>{{ patient.name }} 様</td>
            </tr>
            <tr>
                <th>生年月日</th>
                <td>{{ patient.birth_date|date:"Y年n月j日" }} ({{ patient.age }}歳)</td>
                <th>性別</th>
                <td>{{ patient.get_gender_display }}</td>
            </tr>
            <tr>
                <th>入院期間</th>
                <td colspan="3">
                    {{ patient.admission_date|date:"Y/n/j" }} 〜
                    {% if patient.discharge_date %}
                        {{ patient.discharge_date|date:"Y/n/j" }} (退院)
                    {% else %}
                        {{ today|date:"Y/n/j" }} (入院中)
                    {% endif %}
                </td>
            </tr>
        </table>

        <div class="content-section">
            <div class="section-label">診断名</div>
            <div class="text-content mb-3">
				{{ patient.diagnosis|default:"うつ病" }}
            </div>

            <div class="section-label">入院経過・治療結果</div>
            <div class="text-content" style="min-height: 200px; margin-bottom: 12px;">
                {{ patient.summary_text|linebreaksbr }}
            </div>

            {% include 'rtms_app/print/_hamd_trend_print_compact.html' %}
        </div>

        <div class="content-section">
            <div class="section-label">退院時処方</div>
            <div class="text-content">
                {{ patient.discharge_prescription|linebreaksbr|default:"（記載なし）" }}
            </div>
        </div>

        <div class="page-footer">
            <div>作成日: {{ today|date:"Y年n月j日" }}</div>
            <div>笠寺精治寮病院</div>
            <div>担当医: {{ patient.attending_physician.last_name }} {{ patient.attending_physician.first_name }}</div>
        </div>
</div>
{% endblock %}

{% block print_controls %}
<div class="control-section">
    <h5>印刷オプション</h5>
    <div class="btn-group">
        <button id="print-btn" class="btn btn-primary">
            <i class="fas fa-print"></i> 印刷
        </button>
        <button id="pdf-btn" class="btn btn-success">
            <i class="fas fa-file-pdf"></i> PDF保存
        </button>
        <button id="back-btn" class="btn btn-outline-secondary" data-back-url="{{ back_url }}">
            <i class="fas fa-arrow-left"></i> 戻る
        </button>
    </div>
</div>
{% endblock %}

